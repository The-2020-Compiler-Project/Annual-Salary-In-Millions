## 第一次过程报告

计算机1803-钟洁-20184333

本次编译课设让我接触和学习了许多新知识，第一次使用github与git，第一次使用Markdown编写readme文件，第一次使用vscode编辑器。作为一个下载什么软件都会出问题的“黑洞“，期间也是遇到了很多困难。由于在编译原理实验课的时候尝试写过了词法分析和语法分析（不够完善），所以这次选择了学习新的内容，和组长一起做后端，由于前期四元式，token信息没有确定下来，所以目前只是做了DAG图优化的一部分内容。

### 1.github入门与Git的安装使用

由于不明原因我的电脑无法访问外网，其他同学是进入github的速度比较缓慢，而我是直接无法访问，在编译课做LaTeX作业时，在网上尝试了各种办法，修改hosts文件，DNS服务器地址等，依然进不去。最后不得已向同学求救，下载Qv2ray使用代理才解决问题。但是由于只购买了一个月，课设的时候到期了，购买的网址一直进不去，也订阅不了，最后找同学帮忙订阅了又无法搜到节点，使用不了，最后也是花费了很长时间去排查错误，多次重装才得以解决问题。

这次算是第一次真正接触github，上次作业时并没有去认真了解它，以致上课时学长讲的内容完全不能掌握，课下的时候就自己去百度找了相关的入门博客学习，讲的也是非常仔细。

github入门的博客地址：https://blog.csdn.net/tichimi3375/article/details/79844514?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-5.compare&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-5.compare

在学习过博客的内容后再去复习学长PPT所讲的内容就能大致明白是如何通过git来管理github的托管项目了。以下是自己执行的过程：

（1）git安装，git官网：https://git-scm.com/downloads

（2）git安装后，打开Git Bash，输入如下两个指令

```
$ git config --global user.name "Your Name"
$ git config --global user.email "email@example.com"
```

“Your Name”是注册github时的用户名；"email@example.com"是github绑定的邮箱。

（3）建立git与github间的联系

​	①创建SSH Key:需要查看ssh文件中是否有id_rsa和id_rsa.pub两个文件，没有需要输入下述指令：$ ssh-keygen -t rsa -C "youremail@example.com"

​	②登录github，进入“SSH and GPG keys"页面点击“New SSH Key”，将id_rsa.pub内容粘贴到Key文本框里。

（4）使用git-clone命令从github上同步代码库

git clone git@github.com:The-2020-Compiler-Project/Annual-Salary-In-Millions

（5）将文件放到git仓库 

①将当前目录下修改的所有代码从工作区添加到仓库缓存区。

$ git add XXX

②将缓存区的所有文件正式提交到仓库

$ git commit -m ‘message’（引号内是提交说明）

③将本地仓库代码推送到github对应的仓库

$ git push

(6)分支

①切换分支

$ git checkout -b develop origin/develop(我们组的开发使用的是develop分支)

②将远程仓库中develop分支拉取到本地分支

$ git pull origin develop

③将本地分支推送到远程develop分支

$ git push origin develop

④将develop分支的合并到master分支

$ git merge develop

⑤合并后删除develop分支

$ git branch -d develop

### 2.Markdown编写readme文件

readme文件也是第一次接触，之前一般都习惯于用word来写报告。也是在网上找了相关的博客学习，总的来说是比较简单的，没有遇到什么困难，队友介绍了Typora软件，操作也比较方便。掌握了基本的的操作，例如标题，列表，引用，链接与图片，表格，流程图，甘特图等。

Markdown使用教程：http://note.youdao.com/iyoudao/?p=2411&vendor=unsilent14

### 3.vscode安装与配置

由于之前课设和队友合作时，我用的是codeblock，对方用的是vscode，导致最后程序合并的时候出现了问题，所以这次，我们组在第一天也是统一了使用vscode来编译，这个编译器我也是第一次使用，在配置过程中也是出现了一些问题。

该编译器需要下载安装MinGW-w64和配置环境变量，由于网络原因之前一直下载失败，直到后面代理安装好后才顺利下好。最开始时在网上找了相关的教程配置c++环境，按照教程的指示一步一步执行，配置好了c_cpp_properties.json，launch.json，tasks.json等文件，但是一运行就又会报错，尝试了各种方法也是没有解决。最后又是向自己的队友寻求帮助，采用了另一种编译方式，具体做法如下：

①新建一个.vscode文件，其中保存了上述三个文件（需要修改gdb的路径为自身的安装路径）

②将需要编译的程序的文件夹与.vscode放在同一目录下；

③在vscode中打开要编译的程序；

④打开cmd，输入g++ c:\Users\芜珩\Desktop\code\vscode\es\hello.cpp -o result.exe

（其中的路径是编译程序所在的路径)

⑤输入.\result.exe运行

### 4.文法设计与语义动作设计

由于我和组长的工作是后期的优化与目标代码生成，四元式等没确定之前无法开展工作，所以就和大家一起讨论设计文法。因为项目过于庞大，且自己没能将所有的知识连成一条线，最开始的时候是比较无措的，不知道从何下手，第一天组长分配了我负责布尔表达式的文法及翻译，而我因为没能将书本的知识与要做的内容联系起来，一时不知该如何写，所以就去网上搜索了有关c语言的LL（1）文法进行学习。而当天下午张翰韬同学就完成了对文法的初步设计，组长检查过后发现有些地方的select集相同，不是LL（1）文法，所以我就协助组长一起检查文法有哪些错误，组长做了主要的修改，我负责对赋值语句，表达式，逻辑表达式，算术表达式相关的文法进行检查和修改，并验证组长所做的修改是否正确，对于有争议的地方与组长进行讨论。

文法修改完成后，我协助组长开始设计每个文法的语义动作，我主要负责的是赋值语句，表达式和逻辑表达式的语义动作设计和错误处理，为了方便语法分析的同学写程序我们采用的是文字描述的形式。

所写内容如下（组长经全局考虑有所修改，下为未修改版本）：

8）赋值语句--> =①表达式 ;
①=保存到符号栈。从符号栈中弹出栈顶元素，从对象栈弹出栈顶元素和次栈顶，判断两个操作数是否是同类型的，若不是说明错误，处理错误；若是将栈顶元素的值赋给次栈顶元素，生成四元式（=，次栈顶元素，_,栈顶元素）保存到四元式的vector中。
9）表达式-->算数表达式 逻辑表达式①
     表达式-->字符常量②
     表达式-->字符串常量②
 ①弹出对象栈的栈顶元素和次栈顶元素，栈顶元素作为操作数2，次栈顶元素作为操作数1。判断两个操作数是否是同类型的，不是则说明错误，处理错误；若是弹出符号栈栈顶元素，生成中间变量保存操作结果，并将中间变量压入对象栈。生成四元式（符号，操作数1，操作数2，中间变量）保存至存四元式的vector中。
②将常量压入对象栈

10）逻辑表达式--> >①算数表达式②
       逻辑表达式--> >=①算数表达式②
       逻辑表达式--> <① 算数表达式②
       逻辑表达式--> <= ①算数表达式②
       逻辑表达式--> &&①算数表达式②
       逻辑表达式--> ||①算数表达式②
       逻辑表达式--> !=① 算数表达式②
       逻辑表达式-->?①
①逻辑符号保存到符号栈中
②弹出对象栈的栈顶元素和次栈顶元素，栈顶元素作为操作数2，次栈顶元素作为操作数1。判断两个操作数是否是同类型的，不是则错误处理，弹出符号栈作为符号，生成四元式，将四元式结果压入到操作数栈。

### 5.DAG图优化

帮助组长设计语义动作后，我开始复习课程关于DAG优化的内容，根据上课的内容大致确定了图节点的结构体和划分基本块，构建DAG优化图，重组四元式的设计流程（具体实现正在进行中）：

 //图中的结点结构体

typedef struct Dnode 

{  int num;//节点编号

  bool single; //单分支

  bool isLeaf;//叶节点

  bool iscval;//是常数

  struct Dnode* lchild;

  struct Dnode *rchild;

  string oper;//运算符

  int label_num;

  string label[10];//该结点的主从标记

}Dnode;

**（1）划分基本块流程：**

读取四元式，是否是第一条语句或转向类语句，不是则将该四元式加入当前基本块；是新建一个基本块，将该四元式加入新建的基本块中，继续读取四元式进行判断。直到所有四元式读取完毕后结束。

**（2）构建DAG优化图：**

读取四元式，是否是赋值（=，B,_，A）

是的话就将A添加到B的mark上，若B是中间变量，就让A成为主节点，B为从节点。逆序检查是否已有A，若为主标记则不删除，否则删除。读下一个四元式，

是常值运算(+,10,5,t)或者常值赋值（=，5，_,a)，计算出常数值c，若该常数值已存在则将a添加到c节点的从标记，若无则申请新的结点，令c做主标记，A做从标记，若A已定义过需要删除（主标记免删）

如果是（w,B,C,A),(w,B,_,A)，判断该运算是否已经存在，是的话就将结果添加到该节点标记，不存在的话判断操作数是否存在，如果不存在需要新建操作数节点，然后新建运算节点。若A已定义过需要删除（主标记免删）

上述三种情况都需要判断所附节点的主节点是否为中间变量，是的话需要交换位置，成为主节点。然后读取下一个四元式。

**（3）重组四元式：**

按节点编码顺序依次访问每个节点

若n为带有附加标记的叶节点，若其从节点为非临时变量，生成四元式，从节点=主节点

若n为非叶节点，根据他的左右孩子生成A=BwC或A=wB。判断是否有从节点，若从节点有非临时变量则生成从节点=主节点

### 6.下一步工作

（1）阅读队友们写的词法分析和语法分析代码，了解整个流程，获取在进行优化时可能需要的内容，例如用户定义变量和临时变量的区分，四元式的设计等，完成对接工作。

（2）完善DAG图节点的结构体，代码实现划分基本块，构建DAG优化图，重组四元式的过程。

（3）优化完成后，协助组长进行目标代码的实现。
